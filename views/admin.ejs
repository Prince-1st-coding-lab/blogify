<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/lucide-static/font/lucide.css">

  <style>
    :root {
      --bg: #f4f6f8;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --primary: #4f46e5;
      --border: #e5e7eb;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: 260px;
      background: #111827;
      color: #fff;
      display: flex;
      flex-direction: column;
    }

    .sidebar h1 {
      padding: 20px;
      font-size: 20px;
      font-weight: 600;
      border-bottom: 1px solid #1f2937;
    }

    .nav {
      flex: 1;
      padding: 10px;
    }

    .nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      margin-bottom: 6px;
      text-decoration: none;
      color: #d1d5db;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
    }

    .nav a:hover,
    .nav a.active {
      background: #1f2937;
      color: #fff;
      border-left: 4px solid var(--primary);
    }

    .logout {
      padding: 16px;
      border-top: 1px solid #1f2937;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      background: var(--card);
      padding: 14px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }

    .content {
      padding: 24px;
      overflow-y: auto;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(0,0,0,.05);
    }

    .card h3 { margin: 0 0 10px; font-size: 14px; color: var(--muted); }
    .card h2 { margin: 0; }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 16px;
      overflow: hidden;
    }

    tbody tr:nth-child(even) { background:#f9fafb; }
    tbody tr:hover { background:#eef2ff; }

    th, td {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }

    th { color: var(--muted); font-weight: 500; text-align: left; }

    body.dark {
      --bg: #0b1220;
      --card: #0f172a;
      --text: #e5e7eb;
      --border: #1f2937;
    }

    body.dark tbody tr:nth-child(even) { background:#020617; }
    body.dark tbody tr:hover { background:#1f2937; }

    body.dark .sidebar { background:#020617; }

    .page { display:none; }

    .page-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }

    .page-header h2{ margin:0; }
    .page-header p{ margin:4px 0 0; color:var(--muted); font-size:14px; }

    .btn{
      padding:8px 14px;
      border-radius:10px;
      border:none;
      background:var(--primary);
      color:#fff;
      cursor:pointer;
    }

    .badge{ font-size:12px; padding:4px 10px; border-radius:999px; }
    .badge.published{ background:#dcfce7; color:#166534; }
    .badge.pending{ background:#fef3c7; color:#92400e; }
    .badge.draft{ background:#e5e7eb; color:#374151; }

    .actions button{ background:none; border:none; cursor:pointer; margin-right:6px; }
    .page.active { display:block; }
    #actions{
      border: none;
      background: none;
      color: #1faf56;
      font-weight: bold;
      font-size: 14px;
      text-transform: capitalize;
      cursor: pointer;
    }
  </style>
</head>
<body>

<aside class="sidebar">
  <h1>Blog Admin</h1>
  <nav class="nav">
    <a class="active" data-page="dashboard">Dashboard</a>
    <a data-page="posts">Posts</a>
    <a data-page="edit">Edit</a>
    <a data-page="categories">Categories</a>
    <a data-page="users">Users</a>
    <a data-page="comments">Comments</a>
    <a data-page="media">Media</a>
    <a data-page="analytics">Analytics</a>
    <a data-page="settings">Settings</a>
  </nav>
  <div class="logout">
    <a onclick="logout()" style="cursor:pointer">Logout</a>
  </div>
</aside>

<section class="main">
  <header class="topbar">
    <span id="pageTitle">Dashboard</span>
    <button id="themeToggle">ðŸŒ“</button>
  </header>

  <div class="content">

    <!-- DASHBOARD -->
    <div class="page active" id="dashboard">
      <div class="stats">
        <div class="card"><h3>Total Posts</h3><h2>128</h2></div>
        <div class="card"><h3>Published</h3><h2>96</h2></div>
        <div class="card"><h3>Total Users</h3><h2>42</h2></div>
        <div class="card"><h3>Pending Comments</h3><h2>9</h2></div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Status</th>
            <th>Category</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="dashboard-table">
          <tr>
            <td>no data</td>
            <td>no data</td>
            <td>no data</td>
            <td>no data</td>
            <td>no data</td>
            <td><button>edit</button>|<button>delete</button></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- POSTS -->
    <div class="page" id="posts">
      <div class="card" style="margin-bottom:20px">Manage all blog posts</div>
      <table>
        <thead>
          <tr><th>Title</th><th>Author</th><th>Status</th><th>Date</th><th>Actions</th></tr>
        </thead>
        <tbody>
          <tr><td>JWT Authentication</td><td>Prince</td><td>Pending</td><td>Jan 20</td><td>Edit | Publish | Delete</td></tr>
        </tbody>
      </table>
    </div>
          <div class="page" id="edit">
          <div class="card">
          <h3>Edit Post</h3>

          <input id="eTitle" placeholder="Title" style="width:100%;padding:10px;margin-bottom:10px">
          <!-- <input id="eCategory" placeholder="Category" style="width:100%;padding:10px;margin-bottom:10px"> -->


          <select id="eCategory" style="width:100%;padding:10px;margin-bottom:10px">
            <option>technology</option>
            <option>business</option>
            <option>published</option>
            <option>programming</option>
            <option>education</option>
            <option>news</option>
            <option>lifestyle</option>
          </select>
          <select id="eStatus" style="width:100%;padding:10px;margin-bottom:10px">
            <option>draft</option>
            <option>pending</option>
            <option>published</option>
          </select>

          <button class="btn" onclick="Update()">Update</button>
          <button class="btn" style="background:#6b7280" onclick="goBack()">Cancel</button>
          </div>
          </div>
    <!-- CATEGORIES -->
    <div class="page" id="categories">
      <div class="stats">
        <div class="card"><h3>Total Categories</h3><h2>6</h2></div>
      </div>
      <table>
        <thead><tr><th>Name</th><th>Slug</th><th>Actions</th></tr></thead>
        <tbody>
          <tr><td>Programming</td><td>programming</td><td>Edit | Delete</td></tr>
        </tbody>
      </table>
    </div>

    <!-- USERS -->
    <div class="page" id="users">
      <table>
        <thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Actions</th></tr></thead>
        <tbody>
          <tr><td>Prince</td><td>prince@mail.com</td><td>Author</td><td>Active</td><td>Edit | Block</td></tr>
        </tbody>
      </table>
    </div>

    <!-- COMMENTS -->
    <div class="page" id="comments">
      <table>
        <thead><tr><th>Comment</th><th>User</th><th>Post</th><th>Status</th><th>Actions</th></tr></thead>
        <tbody>
          <tr><td>Great article!</td><td>Reader1</td><td>Node.js</td><td>Pending</td><td>Approve | Delete</td></tr>
        </tbody>
      </table>
    </div>

    <!-- MEDIA -->
    <div class="page" id="media">
      <div class="stats">
        <div class="card"><h3>Total Files</h3><h2>34</h2></div>
        <div class="card"><h3>Storage Used</h3><h2>120MB</h2></div>
      </div>
    </div>

    <!-- ANALYTICS -->
    <div class="page" id="analytics">
      <div class="stats">
        <div class="card"><h3>Daily Views</h3><h2>1,204</h2></div>
        <div class="card"><h3>Likes</h3><h2>342</h2></div>
        <div class="card"><h3>Comments</h3><h2>88</h2></div>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="page" id="settings">
      <div class="card">
        <h3>General Settings</h3>
        <p>Blog name, description, roles, and permissions.</p>
      </div>
    </div>

  </div>
</section>

<script>

  //fetching backend data for dashboard

 async function dashboard(){
     let response = await fetch('/admin/dashboard');
    let data = await response.json();
    let dashboard_table = document.getElementById('dashboard-table');
    dashboard_table.innerHTML = "";
    data.forEach(element => {
      dashboard_table.innerHTML += `
      <tr>
            <td>${element.title}</td>
            <td>${element.fullName}</td>
            <td>${element.status}</td>
            <td>${element.category}</td>
            <td>${element.updated_at.split('T')[0]}</td>
           <td><button id="actions" onclick="openEdit('${element.title}','${element.category}','${element.status}',${element.id})">edit</button>|<button id="actions" style="color:rgb(212, 57, 57);">delete</button></td>
          </tr>
      `;
    });

  }
  dashboard();
  
  document.body.classList.toggle('dark');
  const btn = document.getElementById('themeToggle');
  btn.onclick = () => document.body.classList.toggle('dark');

  const links = document.querySelectorAll('.nav a');
  const pages = document.querySelectorAll('.page');
  const title = document.getElementById('pageTitle');

  links.forEach(link => {
    link.onclick = () => {
      links.forEach(l => l.classList.remove('active'));
      pages.forEach(p => p.classList.remove('active'));

      link.classList.add('active');
      document.getElementById(link.dataset.page).classList.add('active');
      title.textContent = link.textContent;
    };
  });
let pTitle = null;
let pStatus = null;
let pCategory = null;
let update_postId = null;

function openEdit(title, category, status, id) {
  document.querySelector('[data-page="edit"]').click();

  document.getElementById('eTitle').value = title;
  document.getElementById('eCategory').value = category;
  document.getElementById('eStatus').value = status;

  update_postId = id;
}

async function Update() {
  const eTitle = document.getElementById('eTitle').value.trim();
  const eCategory = document.getElementById('eCategory').value.trim();
  const eStatus = document.getElementById('eStatus').value;

  if (!eTitle || !eCategory) {
    alert('Title and Category are required');
    return;
  }

  const body = {
    title: eTitle,
    slug: eTitle.replace(/[^a-zA-Z0-9]/g, '').split(" ").join("-").toLowerCase(),
    status: eStatus,
    category: eCategory
  };

  try {
    const response = await fetch(`/admin/post/update?postId=${update_postId}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });

    const data = await response.json();
    console.log(data);

    alert('Post updated successfully');
    dashboard(); // refresh table
    goBack();

  } catch (error) {
    console.error(error);
    alert('Update failed');
  }
}


function goBack(){
  document.querySelector('[data-page="dashboard"]').click();
}

  async function logout(){
    if(confirm('Are you sure you want to logout?')){
      window.location.href='/login';
    }
  }
</script>

</body>
</html>
