<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Author Dashboard</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* =====================
   CSS VARIABLES (THEME)
===================== */
:root {
  --bg: #f5f7fb;
  --panel: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --primary: #4f46e5;
  --danger: #ef4444;
  --success: #22c55e;
  --shadow: 0 8px 24px rgba(0,0,0,.05);
}

[data-theme="dark"] {
  --bg: #0f172a;
  --panel: #020617;
  --text: #e5e7eb;
  --muted: #94a3b8;
  --shadow: 0 8px 24px rgba(0,0,0,.4);
}

/* =====================
   BASE
===================== */
* { box-sizing:border-box; margin:0; padding:0 }
body {
  font-family: Inter, sans-serif;
  background: var(--bg);
  color: var(--text);
  display:flex;
  min-height:100vh;
}
button { cursor:pointer }
a { text-decoration:none; color:inherit }

/* =====================
   SIDEBAR
===================== */
.sidebar {
  width:260px;
  background:var(--panel);
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  transition:.3s;
}
.sidebar.collapsed { width:80px }
.logo {
  font-weight:700;
  font-size:1.4rem;
  padding:20px;
}
.nav a {
  display:flex;
  gap:12px;
  padding:14px 20px;
  margin:4px 10px;
  border-radius:10px;
  color:var(--muted);
}
.nav a.active,
.nav a:hover {
  background:rgba(79,70,229,.1);
  color:var(--primary);
}
.logout {
  margin-top:auto;
  padding:20px;
  color:var(--danger);
  cursor:pointer;
}

/* =====================
   MAIN AREA
===================== */
.main {
  flex:1;
  display:flex;
  flex-direction:column;
}

/* =====================
   TOP BAR
===================== */
.topbar {
  height:64px;
  background:var(--panel);
  box-shadow:var(--shadow);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}
.topbar input {
  padding:8px 14px;
  border-radius:20px;
  border:1px solid #ccc;
  background:transparent;
  color:var(--text);
}
.actions { display:flex; gap:14px }

/* =====================
   CONTENT
===================== */
.content { padding:24px }
.hidden { display:none }

/* =====================
   CARDS
===================== */
.cards {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin-bottom:30px;
}
.card {
  background:var(--panel);
  padding:20px;
  border-radius:16px;
  box-shadow:var(--shadow);
}
.card h3 { color:var(--muted); font-size:.9rem }
.card p { font-size:1.8rem; font-weight:700 }

/* =====================
   TABLE
===================== */
.table {
  width:100%;
  background:var(--panel);
  border-radius:16px;
  overflow:hidden;
  box-shadow:var(--shadow);
}
.table header, .row {
  display:grid;
  grid-template-columns:2fr 1fr 1fr 2fr;
  padding:14px 20px;
}
.table header { font-weight:600; background:rgba(0,0,0,.03) }
.row { border-top:1px solid rgba(0,0,0,.05) }

.badge {
  padding:4px 10px;
  border-radius:999px;
  font-size:.75rem;
}
.published { background:rgba(34,197,94,.2); color:var(--success) }
.draft { background:rgba(79,70,229,.2); color:var(--primary) }

/* =====================
   FORM / EDITOR
===================== */
.form {
  max-width:900px;
  background:var(--panel);
  padding:24px;
  border-radius:20px;
  box-shadow:var(--shadow);
}
.form input, .form select, .editor {
  width:100%;
  padding:12px;
  margin-bottom:16px;
  border-radius:12px;
  border:1px solid #ccc;
  background:transparent;
  color:var(--text);
}
.editor { min-height:240px }
.form-actions { display:flex; gap:12px }

/* =====================
   BUTTONS
===================== */
.btn {
  padding:10px 18px;
  border-radius:12px;
  border:none;
  background:var(--primary);
  color:white;
}
.btn.outline {
  background:transparent;
  border:1px solid var(--primary);
  color:var(--primary);
}
.btn.danger { background:var(--danger) }

/* =====================
   TOAST
===================== */
.toast {
  position:fixed;
  bottom:20px;
  right:20px;
  background:var(--panel);
  padding:14px 20px;
  border-radius:14px;
  box-shadow:var(--shadow);
  display:none;
}
.toast.show { display:block }

/* =====================
   MODAL
===================== */
.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-box {
  background:var(--panel);
  padding:24px;
  border-radius:20px;
  width:320px;
}
.modal.show { display:flex }

/* =====================
   RESPONSIVE
===================== */
@media(max-width:900px){
  .sidebar { position:fixed; left:-260px; z-index:10 }
  .sidebar.open { left:0 }
}
</style>
</head>

<body data-theme="light">

<aside class="sidebar" id="sidebar">
  <div class="logo">BlogDash</div>
  <nav class="nav">
    <a class="active" onclick="showPage('dashboard', this)">Dashboard</a>
    <a onclick="showPage('posts', this)">My Posts</a>
    <a onclick="showPage('editor', this)">Create Post</a>
    <a onclick="showPage('analytics', this)">Analytics</a>
    <a onclick="showPage('settings', this)">Settings</a>
  </nav>
  <div class="logout" onclick="logout()">Logout</div>
</aside>

<div class="main">
  <div class="topbar">
    <button class="btn outline" onclick="toggleSidebar()">â˜°</button>
    <input placeholder="Search your posts..." />
    <div class="actions">
      <button class="btn outline" onclick="toggleTheme()">ðŸŒ™</button>
      <span>ðŸ‘¤</span>
    </div>
  </div>

  <div class="content">
    <section id="dashboard">
      <div class="cards">
        <div class="card"><h3>Total Posts</h3><p>24</p></div>
        <div class="card"><h3>Published</h3><p>18</p></div>
        <div class="card"><h3>Drafts</h3><p>6</p></div>
        <div class="card"><h3>Comments</h3><p>42</p></div>
      </div>
      <button class="btn" onclick="showPage('editor')">Create New Post</button>
    </section>

    <section id="posts" class="hidden">
      <div class="table">
        <header>
          <div>Title</div><div>Status</div><div>Date</div><div>Actions</div>
        </header>
        <div class="row">
          <div>CSS Grid Mastery</div>
          <div><span class="badge published">Published</span></div>
          <div>Jan 12</div>
          <div>
            <button class="btn outline">Edit</button>
            <button class="btn danger" onclick="openModal()">Delete</button>
          </div>
        </div>
      </div>
    </section>

    <section id="editor" class="hidden">
      <div class="form">
        <input placeholder="Post title" id="post-title"/>
        <select id="post-category">
          <option>Category</option>
          <option>Tech</option>
          <option>Design</option>
        </select>
        <input type="text" id="post-image" placeholder="Image link https://image.com/blog-image">
        <div class="editor" id="content-editor" contenteditable></div>
        <p id="stats">0 words Â· 0 min read</p>
        <div class="form-actions">
          <button class="btn outline" onclick="saveDraft()">Save Draft</button>
          <button class="btn" onclick="publish()">Publish</button>
        </div>
      </div>
    </section>

    <section id="analytics" class="hidden">
      <div class="card">ðŸ“Š Engagement charts go here</div>
    </section>

    <section id="settings" class="hidden">
      <div class="form">
        <input placeholder="Name"/>
        <input placeholder="Email"/>
        <button class="btn">Update Profile</button>
      </div>
    </section>
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="modal" id="modal">
  <div class="modal-box">
    <p>Delete this post?</p><br>
    <button class="btn danger" onclick="closeModal()">Yes</button>
    <button class="btn outline" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
  // LOAD ALL DATA
async function all() {
  let response = await fetch('/author/all');
  let data = await response.json();
  console.log(data);
    
}
all()
/* LOAD SAVED THEME */
function loadSavedTheme() {
  const savedTheme = localStorage.getItem('theme')
  if (savedTheme) {
    document.body.dataset.theme = savedTheme
  }
}
loadSavedTheme()

function toggleTheme(){
  const newTheme =
    document.body.dataset.theme === 'dark' ? 'light' : 'dark'
  document.body.dataset.theme = newTheme
  localStorage.setItem('theme', newTheme)
}

function showPage(id, el){
  document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'))
  document.getElementById(id).classList.remove('hidden')
  document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('active'))
  if (el) el.classList.add('active')
}

function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open')
}

function toast(msg){
  const t=document.getElementById('toast')
  t.textContent=msg
  t.classList.add('show')
  setTimeout(()=>t.classList.remove('show'),2000)
}

function openModal(){ modal.classList.add('show') }
function closeModal(){ modal.classList.remove('show') }

const editor=document.querySelector('.editor')
editor.addEventListener('input',()=>{
  const words=editor.innerText.trim().split(/\s+/).filter(Boolean).length
  document.getElementById('stats').textContent =
    `${words} words Â· ${Math.ceil(words/200)} min read`
})

function saveDraft(){ toast('Draft saved') }

async function publish(){ 
  let post_title = document.getElementById('post-title');
  let post_image = document.getElementById('post-image');
  let post_category = document.getElementById('post-category');
  let editor = document.getElementById('content-editor');
  
  const body = {
    post_title:post_title.value,
    slug:post_title.value.split(" ").join("-"),
    post_image:post_image.value,
    post_category:post_category.value,
    editor:editor.innerHTML
  }
  //////////////////////
 try {
   const response = await fetch('/author/new/post',{
  method:'POST',
  headers:{
    'Content-Type':'application/json'
  },
  body:JSON.stringify(body)
})

 const data = await response.json()
 toast(data.msg)

//  console.log(data); 

 } catch (error) {
  console.log(error);
   }

   
 }


async function logout(){
  if (!confirm('Are you sure you want to logout?')) return
  try {
    const response = await fetch('/admin/logout',{
      method:'POST',
      credentials:'include'
    })
    if (response.ok) location.href='/login'
    else alert('Unable to logout')
  } catch (e) {
    console.error(e)
  }
}
</script>

</body>
</html>
